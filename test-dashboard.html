<!DOCTYPE html>
<html>
<head>
    <title>MindSync API Test Dashboard</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%); 
            color: #fff; 
            margin: 0;
            min-height: 100vh;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .controls {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-result { 
            margin: 15px 0; 
            padding: 15px; 
            border-radius: 8px; 
            border-left: 4px solid;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .success { 
            background: linear-gradient(135deg, #065f46 0%, #047857 100%); 
            border-left-color: #10b981;
        }
        .error { 
            background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%); 
            border-left-color: #ef4444;
        }
        .info { 
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%); 
            border-left-color: #3b82f6;
        }
        .warning {
            background: linear-gradient(135deg, #92400e 0%, #d97706 100%); 
            border-left-color: #f59e0b;
        }
        button { 
            padding: 12px 24px; 
            margin: 8px; 
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(59, 130, 246, 0.3);
        }
        button:hover { 
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        button:active {
            transform: translateY(0);
        }
        .run-all {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 3px 10px rgba(5, 150, 105, 0.3);
        }
        .run-all:hover {
            background: linear-gradient(135deg, #047857 0%, #065f46 100%);
            box-shadow: 0 5px 15px rgba(5, 150, 105, 0.4);
        }
        pre { 
            background: #1a1a1a; 
            padding: 15px; 
            border-radius: 6px; 
            overflow-x: auto; 
            border: 1px solid #333;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
        }
        #results {
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0,0,0,0.1);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        .status-online { background: #10b981; }
        .status-offline { background: #ef4444; }
        .status-testing { background: #f59e0b; }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .endpoint-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .endpoint-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        .endpoint-card h3 {
            margin: 0 0 10px 0;
            color: #3b82f6;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ MindSync API Testing Dashboard</h1>
        <p>Real-time API endpoint validation and performance monitoring</p>
        <div>
            <span class="status-indicator status-offline" id="serverStatus"></span>
            <span id="serverStatusText">Checking server status...</span>
        </div>
    </div>
    
    <div class="controls">
        <button onclick="testHealth()">üîç Health Check</button>
        <button onclick="testAuth()">üîê Authentication</button>
        <button onclick="testNews()">üì∞ News Service</button>
        <button onclick="testWeather()">üå§Ô∏è Weather Service</button>
        <button onclick="testPerformance()">‚ö° Performance</button>
        <button onclick="runAllTests()" class="run-all">üéØ Run All Tests</button>
        <button onclick="clearResults()">üóëÔ∏è Clear</button>
    </div>

    <div class="endpoint-status">
        <div class="endpoint-card">
            <h3>Health</h3>
            <div id="health-status">Not tested</div>
        </div>
        <div class="endpoint-card">
            <h3>Authentication</h3>
            <div id="auth-status">Not tested</div>
        </div>
        <div class="endpoint-card">
            <h3>News</h3>
            <div id="news-status">Not tested</div>
        </div>
        <div class="endpoint-card">
            <h3>Weather</h3>
            <div id="weather-status">Not tested</div>
        </div>
    </div>
    
    <div id="results"></div>

    <script>
        const API_BASE = 'http://localhost:5000';
        const results = document.getElementById('results');
        let testResults = {
            health: false,
            auth: false,
            news: false,
            weather: false
        };

        function updateServerStatus(online) {
            const indicator = document.getElementById('serverStatus');
            const text = document.getElementById('serverStatusText');
            
            if (online) {
                indicator.className = 'status-indicator status-online';
                text.textContent = 'Server Online';
            } else {
                indicator.className = 'status-indicator status-offline';
                text.textContent = 'Server Offline';
            }
        }

        function updateEndpointStatus(endpoint, status, responseTime = null) {
            const statusDiv = document.getElementById(`${endpoint}-status`);
            const timeText = responseTime ? ` (${responseTime}ms)` : '';
            
            if (status === 'success') {
                statusDiv.innerHTML = `<span style="color: #10b981;">‚úÖ Working${timeText}</span>`;
                testResults[endpoint] = true;
            } else if (status === 'error') {
                statusDiv.innerHTML = `<span style="color: #ef4444;">‚ùå Failed</span>`;
                testResults[endpoint] = false;
            } else {
                statusDiv.innerHTML = `<span style="color: #f59e0b;">‚è≥ Testing...</span>`;
            }
        }

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        function clearResults() {
            results.innerHTML = '';
            // Reset endpoint statuses
            Object.keys(testResults).forEach(endpoint => {
                updateEndpointStatus(endpoint, 'reset');
                document.getElementById(`${endpoint}-status`).textContent = 'Not tested';
            });
        }

        async function measureResponseTime(testFunction) {
            const start = Date.now();
            const result = await testFunction();
            const responseTime = Date.now() - start;
            return { ...result, responseTime };
        }

        async function testHealth() {
            try {
                updateEndpointStatus('health', 'testing');
                addResult('üîç Testing server health...', 'info');
                
                const start = Date.now();
                const response = await fetch(`${API_BASE}/health`);
                const responseTime = Date.now() - start;
                const data = await response.json();
                
                updateServerStatus(true);
                updateEndpointStatus('health', 'success', responseTime);
                addResult(`‚úÖ Health Check (${responseTime}ms): <pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
            } catch (error) {
                updateServerStatus(false);
                updateEndpointStatus('health', 'error');
                addResult(`‚ùå Health Check Failed: ${error.message}`, 'error');
            }
        }

        async function testAuth() {
            try {
                updateEndpointStatus('auth', 'testing');
                addResult('üîê Testing authentication...', 'info');
                
                const registerData = {
                    email: `test${Date.now()}@mindsync.com`,
                    password: 'test123',
                    name: 'Test User'
                };

                const start = Date.now();
                const response = await fetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(registerData)
                });
                const responseTime = Date.now() - start;

                const data = await response.json();
                
                if (data.success || response.status === 200) {
                    updateEndpointStatus('auth', 'success', responseTime);
                    addResult(`‚úÖ Auth Registration (${responseTime}ms): <pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
                    
                    // Test profile if token is available
                    if (data.data && data.data.token) {
                        try {
                            const profileStart = Date.now();
                            const profileResponse = await fetch(`${API_BASE}/api/auth/profile`, {
                                headers: { 'Authorization': `Bearer ${data.data.token}` }
                            });
                            const profileTime = Date.now() - profileStart;
                            const profileData = await profileResponse.json();
                            addResult(`‚úÖ Profile Access (${profileTime}ms): <pre>${JSON.stringify(profileData, null, 2)}</pre>`, 'success');
                        } catch (profileError) {
                            addResult(`‚ö†Ô∏è Profile test failed: ${profileError.message}`, 'warning');
                        }
                    }
                } else {
                    updateEndpointStatus('auth', 'error');
                    addResult(`‚ö†Ô∏è Auth Response (${responseTime}ms): <pre>${JSON.stringify(data, null, 2)}</pre>`, 'warning');
                }
            } catch (error) {
                updateEndpointStatus('auth', 'error');
                addResult(`‚ùå Auth Test Failed: ${error.message}`, 'error');
            }
        }

        async function testNews() {
            try {
                updateEndpointStatus('news', 'testing');
                addResult('üì∞ Testing news service...', 'info');
                
                const start = Date.now();
                const response = await fetch(`${API_BASE}/api/news/categories`);
                const responseTime = Date.now() - start;
                const data = await response.json();
                
                updateEndpointStatus('news', 'success', responseTime);
                addResult(`‚úÖ News Categories (${responseTime}ms): <pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
                
                // Test personalized news
                try {
                    const personalizedStart = Date.now();
                    const personalizedResponse = await fetch(`${API_BASE}/api/news/personalized?mood=happy&limit=3`);
                    const personalizedTime = Date.now() - personalizedStart;
                    const personalizedData = await personalizedResponse.json();
                    addResult(`‚úÖ Personalized News (${personalizedTime}ms): <pre>${JSON.stringify(personalizedData, null, 2)}</pre>`, 'success');
                } catch (personalizedError) {
                    addResult(`‚ö†Ô∏è Personalized news test failed: ${personalizedError.message}`, 'warning');
                }
            } catch (error) {
                updateEndpointStatus('news', 'error');
                addResult(`‚ùå News Test Failed: ${error.message}`, 'error');
            }
        }

        async function testWeather() {
            try {
                updateEndpointStatus('weather', 'testing');
                addResult('üå§Ô∏è Testing weather service...', 'info');
                
                const start = Date.now();
                const response = await fetch(`${API_BASE}/api/weather/New York`);
                const responseTime = Date.now() - start;
                const data = await response.json();
                
                updateEndpointStatus('weather', 'success', responseTime);
                addResult(`‚úÖ Weather Data (${responseTime}ms): <pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
                
                // Test coordinates
                try {
                    const coordsStart = Date.now();
                    const coordsResponse = await fetch(`${API_BASE}/api/weather/coordinates?lat=40.7128&lon=-74.0060`);
                    const coordsTime = Date.now() - coordsStart;
                    const coordsData = await coordsResponse.json();
                    addResult(`‚úÖ Weather by Coordinates (${coordsTime}ms): <pre>${JSON.stringify(coordsData, null, 2)}</pre>`, 'success');
                } catch (coordsError) {
                    addResult(`‚ö†Ô∏è Coordinates weather test failed: ${coordsError.message}`, 'warning');
                }
            } catch (error) {
                updateEndpointStatus('weather', 'error');
                addResult(`‚ùå Weather Test Failed: ${error.message}`, 'error');
            }
        }

        async function testPerformance() {
            addResult('‚ö° Running performance benchmark...', 'info');
            
            const endpoints = [
                { name: 'Health', url: `${API_BASE}/health` },
                { name: 'Test', url: `${API_BASE}/test` },
                { name: 'News Categories', url: `${API_BASE}/api/news/categories` }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const runs = 3;
                    let totalTime = 0;
                    
                    for (let i = 0; i < runs; i++) {
                        const start = Date.now();
                        await fetch(endpoint.url);
                        totalTime += Date.now() - start;
                    }
                    
                    const avgTime = Math.round(totalTime / runs);
                    let performanceLevel = 'üî• Excellent';
                    
                    if (avgTime > 500) performanceLevel = '‚ö†Ô∏è Needs Optimization';
                    else if (avgTime > 200) performanceLevel = '‚úÖ Good';
                    
                    addResult(`‚ö° ${endpoint.name}: ${avgTime}ms average - ${performanceLevel}`, 'success');
                } catch (error) {
                    addResult(`‚ùå ${endpoint.name} performance test failed: ${error.message}`, 'error');
                }
            }
        }

        async function runAllTests() {
            clearResults();
            addResult('üöÄ STARTING COMPREHENSIVE API TESTING! ‚ö°', 'info');
            
            const tests = [
                { name: 'Health Check', func: testHealth },
                { name: 'Authentication', func: testAuth },
                { name: 'News Service', func: testNews },
                { name: 'Weather Service', func: testWeather }
            ];
            
            for (const test of tests) {
                addResult(`üîÑ Running ${test.name}...`, 'info');
                await test.func();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            // Summary
            const successCount = Object.values(testResults).filter(Boolean).length;
            const totalTests = Object.keys(testResults).length;
            
            if (successCount === totalTests) {
                addResult(`üéâ ALL TESTS PASSED! (${successCount}/${totalTests}) üí™ LEGENDARY STATUS ACHIEVED!`, 'success');
            } else {
                addResult(`‚ö†Ô∏è Tests completed: ${successCount}/${totalTests} passed. Check failed endpoints above.`, 'warning');
            }
        }

        // Auto-run health check on load
        window.onload = () => {
            addResult('üöÄ Welcome to MindSync API Testing Dashboard!', 'info');
            addResult('üí° Click "Health Check" to verify server is running, then run other tests.', 'info');
            setTimeout(testHealth, 1000);
        };
    </script>
</body>
</html>
